language: generic

branches:
  only:
  - master
  - gh-pages

git:
  depth: 2

env:
 global:
  - GH_REF: "git@github.com:NewFuture/emoji.git"
  - BUILD_PATH: "build/"
  - NAME: "From-Travis-CI"
  - EMAIL: "github@newfuture.cc"

install: true

before_script:
  - echo $RSAKEY >t.rsa && base64 -d t.rsa>~/.ssh/id_rsa && rm t.rsa 
  - chmod 600 ~/.ssh/id_rsa && eval `ssh-agent`
  - git clone --depth=1 -b gh-pages "${GH_REF}" "${BUILD_PATH}"

script:
  - ./build.sh "${BUILD_PATH}"
  - ${BUILD_PATH}e.sh
  - cd ${BUILD_PATH} && ./c.sh

after_success:
  - cp ../emoji.md  emoji.md
  - git config user.name "$NAME" && git config user.email "$EMAIL"
  - git commit -am "Auto build from master $(./e.sh)"
  - git push "${GH_REF}" gh-pages:gh-pages
